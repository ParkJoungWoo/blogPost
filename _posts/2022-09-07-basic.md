---
layout: post
title: "ë‚´ê°€ ë³´ë ¤ê³  ì •ë¦¬í•œ ë°ì´í„°ë¶„ì„ ê¸°ë³¸ 4"
subtitle: ë°ì´í„° ë¶„ì„
categories: project
tags: [data analysis]
---
# ê²°ì¸¡ì¹˜ ì²˜ë¦¬ë°©ë²•
ê²°ì¸¡ê°’ì´ ì—†ë‹¤ë©´ ë¨¸ì‹ ëŸ¬ë‹, ë”¥ëŸ¬ë‹ì´ ê°€ëŠ¥í•˜ë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ ë°ì´í„° ì „ì²˜ë¦¬ê°€ ê¸°ê³„í•™ìŠµì—ì„œ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.
ê·¸ë ‡ë‹¤ë©´ ê²°ì¸¡ê°’ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼ í• ê¹Œ?

1. ê²°ì¸¡ê°’ í™•ì¸
2. ê²°ì¸¡ê°’ì´ ì•„ë‹Œ ë°ì´í„°ì™€ ë¹„êµ
3. ê²°ì¸¡ê°’ ëŒ€ì²´ or ê²°ì¸¡ê°’ ì œê±°

ë§Œì•½ ë°ì´í„°(sample, row, instance)ê°€ ë§ìœ¼ë©´ ì œê±°í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

ë²”ì£¼í˜• ë³€ìˆ˜ì˜ ê²°ì¸¡ê°’ ëŒ€ì²´ì—ì„œ ìì£¼ ì“°ì´ëŠ” ë°©ë²•

ê²°ì¸¡ì¹˜ ë²”ì£¼ë¥¼ ë§Œë“¤ì–´ ê²°ì¸¡ì¹˜ ë¹„ìœ¨ì´ 5%ì´í•˜ì¼ ê²½ìš°ì—ëŠ” ì‚­ì œí•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.


ì—°ì†í˜• ë²”ì£¼ë°ì´í„°ì˜ ê²°ì¸¡ê°’ ëŒ€ì²´ì—ì„œ ìì£¼ ì“°ì´ëŠ” ë°©ë²•

1. í‰ê· ê°’ìœ¼ë¡œ ëŒ€ì²´
2. ì´ìƒê°’ì´ ë§ìœ¼ë©´ ì¤‘ì•™ê°’ìœ¼ë¡œ ëŒ€ì²´

ì‹œê³„ì—´ ë³€ìˆ˜ : 1ì‹œ, 2ì‹œ, 3ì‹œ...

ë¨¸ì‹ ëŸ¬ë‹ì— ì˜í•´ ì˜ˆì¸¡ ëª¨ë¸ ë§Œë“¤ê³  ëª¨ë¸ë¡œ ì˜ˆì¸¡ê°’ ì±„ìš°ê¸°

### ì°¸ê³ 
ë¨¸ì‹ ëŸ¬ë‹ì˜ ê²½ìš° í•œê°œì˜ ë°ì´í„°ë¥¼ ì–´ë–¤ ì „ì²˜ë¦¬ë¥¼ í–ˆëŠ”ê°€ì— ë”°ë¼
ì—¬ëŸ¬ê°œì˜ ë°ì´í„° ì…‹ìœ¼ë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ì´ë•Œ ê·¸ ì—¬ëŸ¬ê°œì˜ ë°ì´í„° ì…‹ì„ ì˜ ì €ì¥í•˜ê³ , ê°€ì ¸ë‹¤ ì“°ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

## ê²°ì¸¡ì¹˜ ì°¾ê¸°

isnull(),isna()
```python
df = sns.load_dataset('titanic')
# booleanìœ¼ë¡œ ë¦¬í„´í•´ì¤Œ
df.isnull()
df.isna()
# ê²°ì¸¡ì¹˜ê°€ ì•„ë‹Œ ê²½ìš°ìš°
df.notnull()
df.notna()

# ê° ì»¬ëŸ¼ì˜ nullì¸ ìˆ˜
df.isnull().sum() 

# ì „ì²´ nullì˜ ìˆ˜
df.isnull().sum().sum()

# boolean ì´ê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ì¸ë±ì‹±ì´ ê°€ëŠ¥í•˜ë‹¤
# null ì¸ ê°’ë§Œ ê°€ì ¸ì˜¤ê¸°
df[df.isnull()]
# ageì»¬ëŸ¼ì´ nullì¸ ê°’ë§Œ ê°€ì ¸ì˜¤ê¸°
df[df['age'].isnull()]
```

## ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°

### fillnaë¥¼ í†µí•´ì„œ ì±„ìš°ê¸°ê°€ ê°€ëŠ¥í•˜ë‹¤.
```python
# ê°’ì„ ë³µì‚¬í•˜ê¸°(ê¹Šì€ ë³µì‚¬)
df1 = df.copy()
# df1ì˜ ageì»¬ëŸ¼ì—ì„œ nanì¸ ê°’ì„ 700ìœ¼ë¡œ ì±„ìš°ê³  í•˜ìœ„ 5ê°œë¥¼ ê°€ì ¸ì˜¤ê¸°
df1['age'].fillna(700).tail(5) #df1ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.

# ì¹´í…Œê³ ë¦¬í˜• ë°ì´í„°ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•˜ê³  ê·¸ ì¹´í…Œê³ ë¦¬ë¥¼ ê²°ì¸¡ì¹˜ ì±„ìš¸ ìˆ˜ ìˆë‹¤.
# No Dataë¼ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•˜ê³ 
# ì—†ëŠ” ê°’ì„ No Dataë¼ê³  ì¶”ê°€í•œë‹¤.
df1 = df1['deck'].cat.add_categories('No Data')
df1.fillna('No Data')
```

```python
# ì—°ì†í˜• ë²”ì£¼ ë°ì´í„°ì—ì„œ ê²°ì¸¡ì¹˜ ì±„ìš°ê¸°

# í‰ê· ìœ¼ë¡œ ì±„ìš°ê³  í•˜ìœ„ 5ê°œ ë³´ê¸°
df1['age'].fillna(df1['age'].mean()).tail(5)

# ì¤‘ì•™ê°’ìœ¼ë¡œ ì±„ìš°ê³  í•˜ìœ„ 5ê°œ ë³´ê¸°
df1['age'].fillna(df1['age'].median()).tail(5)

# ìµœë¹ˆê°’ìœ¼ë¡œ ì±„ìš°ê³  í•˜ìœ„ 5ê°œ ë³´ê¸°
df1['deck'].mode() -> Series íƒ€ì…ì´ë‹¤.
df1['deck'].fillna(df1['deck'].mode()[0]).tail(5)
```
### fillnaì˜ methodë¥¼ ë¹„êµí•´ë³´ê¸°

![test](/assets/img/0907/test.png)
```python
A = pd.DataFrame()
A['org'] = pd.Series([np.nan, 1, 2, np.nan, np.nan, 3, 4])
A['bfill'] = A['org'].fillna(method='bfill')
A['ffill'] = A['org'].fillna(method='ffill')
A
```
### ì—¬ëŸ¬ ì»¬ëŸ¼ ê²°ì¸¡ì¹˜
ë§Œì•½ ì—¬ëŸ¬ ì»¬ëŸ¼ì˜ ê²°ì¸¡ì¹˜ë¥¼ ì±„ìš°ê¸° ìœ„í•´ì„œëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ
```python
# ì¼ë°˜ì ì¸ ìƒê°
# DFì˜ ë‚˜ì´ ì»¬ëŸ¼ì—ì„œ ë‚¨ìì´ê³  ê²°ì¸¡ì¹˜ì¸ ê²ƒì„ ë‚˜ì´ì˜ í‰ê· ìœ¼ë¡œ ì±„ìš°ê¸°

df.loc[(df['who']=='man')&(df['age'].isna()),'age'] = df.loc[df['who']=='man', 'age'].mean()

# transformì„ í™œìš©í•˜ê¸°

# transformìœ¼ë¡œ í‰ê· ì„ êµ¬í•˜ë©´ whoì— ë”°ë¼ì„œ í‰ê· ìœ¼ë¡œ ì±„ì›Œì§„ ê²ƒì´ë‹¤.
# ì¦‰ ìœ„ì™€ ê°™ì´ í‰ê·  ë”°ë¡œ êµ¬í•˜ê³  ê²°ì¸¡ì¹˜ ëŒ€ì…ì´ ì•„ë‹Œ ì•Œì•„ì„œ ê° ì»¬ëŸ¼ì˜ í‰ê· ì— ë§ê²Œ ë§Œë“œëŠ” ê²ƒ
df.groupby('who')['age'].transform('mean')
```
### dropnaë¡œ í•˜ë‚˜ë¼ë„ ê²°ì¸¡ì¹˜ê°€ ì¡´ì¬í•˜ëŠ” í–‰ ì‚­ì œí•˜ê¸°

```python
dropna() -> defaultëŠ” how='any'
# í•˜ë‚˜ë¼ë„ nanê°’ì´ ì¡´ì¬í•˜ë©´ ê·¸ í–‰ì„ ì‚­ì œí•œë‹¤ëŠ” ì˜ë¯¸

how='all'ì¼ ê²½ìš°ì—ëŠ” 
# ëª¨ë“  ì—´ì´ nanì¼ê²½ìš° ê·¸ í–‰ì„ ì‚­ì œí•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
display(df1.dropna(),df1.dropna(how='all'),df1)

# ì—´ì„ ì‚­ì œí•˜ê³  ì‹¶ì€ ê²½ìš° axis=1ì„ ì˜µì…˜ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
display(df1.dropna(axis=1),df1.dropna(axis=1,how='all'),df1)

# ê²°ì¸¡ì¹˜ ë¹„ìœ¨ì„ ì„¤ì •í•´ì„œ ì‚­ì œ
df.dropna(axis=1, thresh=len(df)*0.6)
```

## ì „ì²˜ë¦¬í•˜ê¸°(ì¶”ê°€, ì‚­ì œ)

### ì»¬ëŸ¼ ì¶”ê°€í•˜ê¸°

ìƒˆë¡œìš´ ì»¬ëŸ¼ì„ ì§€ì •í•´ì„œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
```python
df1['VIP'] = True
```
### í–‰ ì‚­ì œí•˜ê¸°

```python
# index 1ë²ˆí–‰ ì‚­ì œí•˜ê¸°
df1.drop(1)
# ë™ì¼í•œ ë°©ë²• = df1.drop(1, axis=0)

# ì—¬ëŸ¬ í–‰ ì‚­ì œí•˜ê¸°
# í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ mydf
mydf = pd.DataFrame(np.arange(20).reshape(-1, 2), columns=['A', 'B'])
# indexë¥¼ ì´ë ‡ê²Œ ì„¤ì •
mydf.index = list('abcdefghij')
# a,i,e í–‰ ì‚­ì œí•˜ê¸°
mydf.drop(list("aie"))
# ìƒìœ„ 5ê°œ í–‰ ì‚­ì œí•˜ê¸°
mydf.drop(mydf.index[:5])

#range í™œìš©í•˜ê¸°
df1.drop(range(1,10,2))
df1.drop(df1.index[1:10:2])

```
### ì—´ ì‚­ì œí•˜ê¸°
```python
df1.drop('class', axis=1).head(5)

# ë‹¤ìˆ˜ì˜ ì—´ ì‚­ì œí•˜ê¸°
df1.drop(['who', 'deck', 'alive'], axis=1)
df1.drop('who deck alive'.split(' '), axis=1)
```

## ì»¬ëŸ¼ê°„ì˜ ì—°ì‚°

### ì»¬ëŸ¼ì˜ í•©ìœ¼ë¡œ ìƒˆë¡œìš´ ì»¬ëŸ¼ ë§Œë“¤ê¸°
```python
# df1ì˜ 'sibsp' ì»¬ëŸ¼ê³¼ 'parch' ì»¬ëŸ¼ì„ ë”í•˜ì—¬ 'family'ë¼ëŠ” ìƒˆë¡œìš´ ì»¬ëŸ¼ì„ ì¶”ê°€
df1['family'] = df['sibsp']+df['parch']
# ë¬¸ìì—´ì¸ ê²½ìš° concatìœ¼ë¡œ ê°€ëŠ¥í•˜ë‹¤.
df1['gender'] = df['who'] + '-'+ df['sex']
```

ì†Œìˆ˜ì  ë‘ë²ˆì§¸ ìë¦¬ ê¹Œì§€ ë‚˜ëˆ„ì–´ì„œ ì»¬ëŸ¼ì— ì¶”ê°€í•˜ê¸°
```python
# round í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸°
df1['round'] = (df1['fare']/df1['age']).round(2)
df1['round'] = round(df1['fare']/df1['age'],2)
```

## ğŸŒŸíƒ€ì… ë³€í™˜

ì—¬ëŸ¬ íƒ€ì…ì´ ì¡´ì¬í•œë‹¤.
```python
df1 = df.copy()
df1.info()
.....
dtypes: bool(2), category(2), float64(2), int64(4), object(5)
```
### astypeì„ í™œìš©í•˜ì

```python
df1['pclass'].astype('int32').head(5)
df1['pclass'].astype('float32').head(5)
df1['pclass'].astype('str').head(5)
df1['who'].astype('category').head(5)

# íƒ€ì… í™•ì¸
print(df1['who'].dtype)
```
```python
# ì¹´í…Œê³ ë¦¬ë¡œ íƒ€ì…ì„ ë°”ê¿¨ì„ ê²½ìš°
df1['who'] = df1['who'].astype('category')
df1['who'].cat.codes

#ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ë°”ê¾¸ê¸°
["Group (%s)" % g for g in df1['who'].cat.categories]
```
ì¶œë ¥
```
0      1
1      2
2      2
3      2
4      1
      ..
886    1
887    2
888    2
889    1
890    1
ìœ„ì™€ ê°™ì´ category codeë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.
```

ì¹´í…Œê³ ë¦¬ ì •ë ¬
```python
A = pd.DataFrame()
A['ìš”ì¼1'] = pd.Series(list("ì›”ì›”ìˆ˜ëª©ê¸ˆí™”ëª©ìˆ˜ëª©ê¸ˆì›”"))
A['ìš”ì¼2'] = pd.Categorical(A['ìš”ì¼1'], categories=list("ì›”í™”ìˆ˜ëª©ê¸ˆí† "))
A['ìš”ì¼3'] = pd.Categorical(A['ìš”ì¼1'], categories=list("ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼"))
# A.sort_values('ìš”ì¼2')
A.sort_values('ìš”ì¼2')

# ë§Œì•½ ìš”ì¼1ë¡œ ì •ë ¬í•œë‹¤ë©´ ì‚¬ì „ìˆœìœ¼ë¡œ ì •ë ¬ì´ ë˜ì§€ë§Œ

# Categoricalë¡œ ìƒì„±í•œ ìš”ì¼2ë¡œ ì •ë ¬í•œë‹¤ë©´ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ìˆœì„œë¡œ ì •ë ¬í•  ìˆ˜ ìˆë‹¤.

# ì•ìœ¼ë¡œ ë°ì´í„°ê°€ ì¶”ê°€ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ categoriesë¥¼ ê³ ë ¤í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

# ìƒˆë¡œìš´ ì¹´í…Œê³ ë¦¬ê°€ ë‚˜ì™”ì„ ê²½ìš°
A.iloc[0,1] = 'ì¼' # ì¹´í…Œê³ ë¦¬ê°€ ì¡´ì¬í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë¶ˆê°€ëŠ¥
A.iloc[0,2] = 'ì¼' # ê°€ëŠ¥
```
## ğŸŒŸë‚ ì§œ, ì‹œê°„
â›” ë‚ ì§œ íƒ€ì…ì€ ë”°ë¡œ ì¡´ì¬í•œë‹¤.
```python
# ì„ ì–¸ë°©ì‹
dates = pd.date_range('20210101', periods=df.shape[0], freq='15H')
# 20210101ë¶€í„° 15ì‹œì˜ ê°„ê²©ìœ¼ë¡œ ë§Œë“¤ê¸°
```
datetime íƒ€ì…ì—ì„œëŠ” dt ì ‘ê·¼ìë¡œ ë‹¤ìŒê³¼ ê°™ì€ ë‚ ì§œ ì†ì„±ì— ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

```python
A = pd.DataFrame()
A['year'] = df1['date'].dt.year
A['month'] = df1['date'].dt.month

```
ë§Œì•½ íƒ€ì…ì´ datetimeì´ ì•„ë‹ ê²½ìš°
```python
# íƒ€ì…ì„ ë³€ê²½ì‹œì¼œì¤˜ì•¼í•œë‹¤.
df2['ëŒ€ì—¬ì¼ì'] = df2['ëŒ€ì—¬ì¼ì'].astype('datetime64')
df2['ëŒ€ì—¬ì¼ì'] = pd.to_datetime(df2['ëŒ€ì—¬ì¼ì'])

# pd.to_datetimeì„ ì¨ì•¼í•˜ëŠ” ê²½ìš°ëŠ”?
A['date'] = pd.Series(['220907','220908','211209'])
A['astype'] = A['date'].astype('datetime64')
A['to_datetime'] = pd.to_datetime(A['date'], format='%y%m%d')
A
```
ë‚ ì§œê°€ astypeê³¼ to_datetimeì´ ë‹¤ë¥´ë‹¤

![date](/assets/img/0907/date.png)

```python
# ëŒ€ì…ì‹œí‚¨ ì´í›„ì—ëŠ” dtë¥¼ í†µí•´ì„œ ì ‘ê·¼í•˜ê¸°
df2['ëŒ€ì—¬ì¼ì'].dt.dayofweek
df2['ëŒ€ì—¬ì¼ì'].dt.weekday
```

Datetime ë¶„ë¦¬í•˜ê¸°
```python
t = df1['date'].dt
dt_list = ['year', 'month', 'day', 'hour', 'dayofweek']
data = {x:eval(f't.{x}) for x in dt_list}
A = pd.DataFrame(data)
```

ğŸŒ±íŒ
```python
ë°ì´í„° í”„ë ˆì„ ìœ ì§€ ë°©ë²• -> [[]] ë¡œ í‘œí˜„í•˜ê¸°
# ValueError: Unable to parse string "\N" at position 2344
âœ”ï¸ì´ëŸ¬í•œ ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚˜ë©´ intê°€ ë¬¸ì œê°€ ìˆë‹¤ëŠ” ì˜ë¯¸.
df2.iloc[[2344,]]

# to_numericì—ì„œ errors ì„¤ì •ì„ coerceë¡œ ì„¤ì •í•œë‹¤ë©´ NaN ê°’ìœ¼ë¡œ ì¹˜í™˜í•œë‹¤.
temp = pd.to_numeric(df2['ìš´ë™ëŸ‰'], errors='coerce' )
# errors='ignore'ë¡œ ì§€ì •í•˜ë©´ ë³€í™˜ì´ ë˜ì§€ ì•Šê³  ë¬´ì‹œí•œë‹¤.
```

## group by

ê·¸ë£¹ë³„ë¡œ ë°ì´í„° í”„ë ˆì„ì„ ì§‘ê³„í•˜ê¸°


```python
df = sns.load_dataset('titanic')
df.groupby('survived').mean() -> ìƒì¡´ ê¸°ì¤€ìœ¼ë¡œ í‰ê· ì„ ì§‘ê³„í•˜ê¸°

# ì—¬ëŸ¬ ì¹¼ëŸ¼ ì§€ì •í•´ì„œ ì›í•˜ëŠ” ì§‘ê³„ ìˆ˜í–‰
df.groupby(['sex','pclass'])['survived'].mean()
# ë°ì´í„° í”„ë ˆì„ìœ¼ë¡œ ìœ ì§€í•˜ê¸°
df.groupby(['sex','pclass'])[['survived']].mean()

# ë‹¤ì¤‘ ì»¬ëŸ¼ í™œìš©
df.groupby(['sex','pclass'])[['survived','age']].mean()
# ë‹¤ì¤‘ ì»¬ëŸ¼ + ë‹¤ì¤‘ í•¨ìˆ˜
df.groupby(['sex','pclass'])[['survived','age']].agg(['mean','sum'])
df.groupby(['sex','pclass'])[['survived','age']].agg([np.mean, np.sum])
```

## reset index
```python
# urvivedì˜ í‰ê· ì„ ì„±ë³„ê³¼ pclassì„ ê¸°ì¤€ìœ¼ë¡œ ì§‘ê³„ í›„ indexë¥¼ ì´ˆê¸°í™”
df.groupby(['sex','pclass'])[['survived']].mean().reset_index()
```
ì¶œë ¥


||sex	|pclass	|survived|
|---|---|---|---|
|0	|female	|1	|0.968085
|1	|female	|2	|0.921053
|2	|female	|3	|0.500000
|3	|male	|1	|0.368852
|4	|male	|2	|0.157407
|5	|male	|3	|0.135447